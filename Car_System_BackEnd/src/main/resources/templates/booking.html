<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Luxora|Booking</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-blue-100">
    <div class="flex flex-col lg:flex-row">
        <!-- Sidebar -->
        <div class="bg-white pt-4 px-0 flex flex-col items-center">
            <div class="items-center mb-8">
                <span class="text-2xl font-bold px-3">LUXORA</span>
            </div>
            <div class="flex flex-col space-y-6">
                <a class="flex items-center justify-center text-gray-500 hover:text-black" href="#">
                    <i class="fas fa-car-side text-2xl"></i>
                </a>
                <a class="flex items-center justify-center text-gray-500 hover:text-black" href="#">
                    <i class="fas fa-calendar-alt text-2xl"></i>
                </a>
                <a class="flex items-center justify-center text-gray-500 hover:text-black" href="#">
                    <i class="fas fa-heart text-2xl"></i>
                </a>
                <a class="flex items-center justify-center text-gray-500 hover:text-black" href="#">
                    <i class="fas fa-cog text-2xl"></i>
                </a>
                <a class="flex items-center justify-center text-gray-500 hover:text-black" href="#">
                    <i class="fas fa-bell text-2xl"></i>
                </a>
                <a class="flex items-center justify-center text-gray-500 hover:text-black" href="#">
                    <i class="fas fa-sign-out-alt text-2xl"></i>
                </a>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="flex-1 p-6">
            <div class="flex justify-between items-center mb-6">
                <div class="flex items-center space-x-4">
                    <button class="bg-gray-200 text-black px-4 py-2 rounded-full">Light mode</button>
                    <button class="bg-black text-white px-4 py-2 rounded-full">Dark</button>
                </div>
                <div class="flex items-center space-x-4">
                    <span></span>
                    <img th:src="${user.profileImage ?: 'https://placehold.co/40x40'}" alt="User profile picture" class="rounded-full" width="40" height="40">
                    <span th:text="${user.name ?: 'Gokul'}">Gokul</span>
                </div>
            </div>
            
            <div class="flex flex-col lg:flex-row">
                <!-- Filters -->
                <div class="flex flex-col lg:flex-row">
                    <!-- Enhanced Filters Section -->
                    <div class="bg-white p-6 rounded-lg shadow-lg w-full lg:w-1/4 mb-6 lg:mb-0 lg:mr-6">
                        <form id="carFilterForm" th:action="@{/cars}" method="get">
                            <div class="flex justify-between items-center mb-4">
                                <span class="text-lg font-semibold">Advanced Filters</span>
                                <button type="button" class="text-blue-500" onclick="resetFilters()">Reset All</button>
                            </div>
                            
                            <!-- Location & Dates -->
                            <div class="mb-6">
                                <label class="block text-sm font-medium mb-2">Location</label>
                                <input type="text" name="pickupLocation" th:value="${param.pickupLocation}" 
                                       class="w-full p-2 border rounded-lg mb-2" placeholder="Pick-up Location">
                                <input type="text" name="returnLocation" th:value="${param.returnLocation}"
                                       class="w-full p-2 border rounded-lg" placeholder="Return Location">
                            </div>
        
                            <!-- Date/Time Pickers -->
                            <div class="mb-6">
                                <label class="block text-sm font-medium mb-2">Rental Period</label>
                                <input type="datetime-local" name="pickupDateTime" th:value="${param.pickupDateTime}"
                                       class="w-full p-2 border rounded-lg mb-2">
                                <input type="datetime-local" name="returnDateTime" th:value="${param.returnDateTime}"
                                       class="w-full p-2 border rounded-lg">
                            </div>
        
                            <!-- Price Range -->
                            <div class="mb-6">
                                <label class="block text-sm font-medium mb-2">Daily Price Range (â‚¹)</label>
                                <div class="flex justify-between text-sm mb-2">
                                    <span id="minPrice">250</span>
                                    <span id="maxPrice">3000</span>
                                </div>
                                <input type="range" name="priceRange" id="priceRange" min="250" max="3000" 
                                       th:value="${param.priceRange ?: 250}"
                                       class="w-full" oninput="updatePriceLabels()">
                            </div>
        
                            <!-- Vehicle Specifications -->
                            <div class="mb-6">
                                <label class="block text-sm font-medium mb-2">Vehicle Type</label>
                                <div class="grid grid-cols-2 gap-2">
                                    <div th:each="type : ${vehicleTypes}">
                                        <label class="flex items-center">
                                            <input type="checkbox" name="vehicleType" th:value="${type}"
                                                   th:checked="${param.vehicleType != null && param.vehicleType.contains(type)}"
                                                   class="mr-2">
                                            <span th:text="${type}">Sedan</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
        
                            <!-- Transmission & Fuel Type -->
                            <div class="mb-6 grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Transmission</label>
                                    <select name="transmission" class="w-full p-2 border rounded-lg">
                                        <option value="">Any</option>
                                        <option th:each="trans : ${transmissions}" 
                                                th:value="${trans}" 
                                                th:text="${trans}"
                                                th:selected="${param.transmission == trans}">
                                            Automatic
                                        </option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Fuel Type</label>
                                    <select name="fuelType" class="w-full p-2 border rounded-lg">
                                        <option value="">Any</option>
                                        <option th:each="fuel : ${fuelTypes}"
                                                th:value="${fuel}"
                                                th:text="${fuel}"
                                                th:selected="${param.fuelType == fuel}">
                                            Petrol
                                        </option>
                                    </select>
                                </div>
                            </div>
        
                            <!-- Capacity Filters -->
                            <div class="mb-6 grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium mb-2">Seating Capacity</label>
                                    <input type="number" name="minSeats" min="2" max="8" 
                                           th:value="${param.minSeats ?: 2}"
                                           class="w-full p-2 border rounded-lg" placeholder="Min seats">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium mb-2">Luggage Capacity</label>
                                    <input type="number" name="minBags" min="1" max="5" 
                                           th:value="${param.minBags ?: 1}"
                                           class="w-full p-2 border rounded-lg" placeholder="Min bags">
                                </div>
                            </div>
        
                            <!-- Rating Filter -->
                            <div class="mb-6">
                                <label class="block text-sm font-medium mb-2">Minimum Rating</label>
                                <select name="minRating" class="w-full p-2 border rounded-lg">
                                    <option value="0">Any Rating</option>
                                    <option th:each="i : ${#numbers.sequence(1, 5)}"
                                            th:value="${i}"
                                            th:text="${i + '+'}"
                                            th:selected="${param.minRating == i}">
                                        4+
                                    </option>
                                </select>
                            </div>
        
                            <!-- Advanced Features -->
                            <div class="mb-6">
                                <label class="block text-sm font-medium mb-2">Features</label>
                                <div class="grid grid-cols-2 gap-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" name="features" value="GPS"
                                               th:checked="${param.features != null && param.features.contains('GPS')}"
                                               class="mr-2">
                                        <span>GPS Navigation</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" name="features" value="Bluetooth"
                                               th:checked="${param.features != null && param.features.contains('Bluetooth')}"
                                               class="mr-2">
                                        <span>Bluetooth</span>
                                    </label>
                                </div>
                            </div>
        
                            <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700">
                                Apply Filters
                            </button>
                        </form>
                    </div>
                    
                    <!-- Car Listings -->
                    <div class="flex-1">
                        <div class="flex justify-between items-center mb-6">
                            <span class="text-lg font-semibold" id="carCount" 
                                  th:text="${#lists.size(cars)} + ' cars to rent'">24 cars to rent</span>
                            <a class="text-blue-500" href="#" onclick="resetFilters()">View all</a>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="carListings">
                            <!-- Car cards from backend -->
                            <th:block th:each="car : ${cars}">
                                <div class="bg-white p-4 rounded-lg shadow-lg">
                                    <div class="flex justify-between items-center mb-4">
                                        <span th:if="${car.isNew}" class="bg-red-500 text-white px-2 py-1 rounded-full text-xs">New</span>
                                        <span th:switch="${car.status}" class="px-2 py-1 rounded-full text-xs" 
                                              th:classappend="${car.status == 'available' ? 'bg-green-500 text-white' : 
                                                               car.status == 'booked' ? 'bg-gray-500 text-white' : 
                                                               'bg-yellow-500 text-white'}">
                                            <th:block th:case="'available'">Available</th:block>
                                            <th:block th:case="'booked'">Booked</th:block>
                                            <th:block th:case="*">Maintenance</th:block>
                                        </span>
                                    </div>
                                    <img th:src="${car.image}" 
                                         th:alt="${car.make} + ' ' + ${car.model}" 
                                         class="w-full mb-4 rounded-lg h-48 object-cover">
                                    <div class="flex justify-between items-center">
                                        <div>
                                            <span class="block font-semibold" th:text="${car.make} + ' | ' + ${car.model}">Alfa Romeo | Giulia</span>
                                            <span class="block text-gray-500" th:text="${car.trim} + ', ' + ${car.year}">Veloce, 2024</span>
                                        </div>
                                        <span class="font-semibold" th:text="'â‚¹' + ${car.pricePerHour} + '/hour'">â‚¹750/hour</span>
                                    </div>
                                </div>
                            </th:block>
                            
                            <!-- Maintenance Card -->
                            <div class="bg-gradient-to-r from-blue-500 to-indigo-500 p-6 rounded-lg shadow-lg text-white flex flex-col justify-between">
                                <div>
                                    <span class="block text-lg font-semibold mb-2">Time for Maintenance!</span>
                                    <span class="block mb-4">Check out your cars to make them drive good</span>
                                </div>
                                <a class="bg-white text-blue-500 px-4 py-2 rounded-full text-center" href="#">Read more</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        // Recreate the JavaScript from the original booking.html
        function filterCars() {
            const selectedTypes = Array.from(document.querySelectorAll('input[name="vehicleType"]:checked'))
                                  .map(el => el.value);
            const minPrice = parseInt(document.getElementById('priceRange').value);
            const transmission = document.querySelector('select[name="transmission"]').value;
            const fuelType = document.querySelector('select[name="fuelType"]').value;
            const minSeats = parseInt(document.querySelector('input[name="minSeats"]').value) || 2;
            const minBags = parseInt(document.querySelector('input[name="minBags"]').value) || 1;

            // In a real Thymeleaf application, this would typically be handled server-side
            const filtered = /*[[${cars}]]*/ [];

            // Simulating filtering logic (would be replaced by server-side filtering)
            const filteredCars = filtered.filter(car => {
                return car.pricePerHour >= minPrice &&
                       (selectedTypes.length === 0 || selectedTypes.includes(car.type)) &&
                       (transmission === '' || car.transmission === transmission) &&
                       (fuelType === '' || car.fuelType === fuelType) &&
                       car.seats >= minSeats &&
                       car.bags >= minBags;
            });

            // Update car listings (would typically be handled by Thymeleaf)
            renderCars(filteredCars);
            updateCarCount(filteredCars.length);
        }

        function updateCarCount(count) {
            document.getElementById('carCount').textContent = `${count} cars available`;
        }

        function resetFilters() {
            document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => checkbox.checked = false);
            document.getElementById('priceRange').value = 250;
            document.querySelector('select[name="transmission"]').value = '';
            document.querySelector('select[name="fuelType"]').value = '';
            document.querySelector('input[name="minSeats"]').value = 2;
            document.querySelector('input[name="minBags"]').value = 1;
            filterCars();
        }

        function updatePriceLabels() {
            const range = document.getElementById('priceRange');
            document.getElementById('minPrice').textContent = range.min;
            document.getElementById('maxPrice').textContent = range.value;
        }

        // Add event listeners to filter inputs
        document.addEventListener('DOMContentLoaded', () => {
            updatePriceLabels();
            
            document.querySelectorAll('input[name="vehicleType"], select[name="transmission"], select[name="fuelType"], input[name="minSeats"], input[name="minBags"]')
                .forEach(input => {
                    input.addEventListener('change', filterCars);
                    input.addEventListener('input', filterCars);
                });
        });
    </script>
</body>
</html>
